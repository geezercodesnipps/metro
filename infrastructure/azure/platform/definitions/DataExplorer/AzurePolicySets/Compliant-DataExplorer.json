{
  "type": "Microsoft.Authorization/policySetDefinitions",
  "apiVersion": "2021-06-01",
  "name": "Compliant-Data-Explorer",
  "properties": {
    "metadata": {
      "version": "1.0.0",
      "category": "Azure Data Explorer"
    },
    "policyType": "Custom",
    "displayName": "Enforce secure-by-default Data Explorer for regulated industries",
    "description": "This policy initiative is a group of policies that ensures Data Explorer is compliant per regulated Landing Zones",
    "policyDefinitionGroups": [
      {
        "name": "Encryption",
        "category": "Data Protection",
        "displayName": "Ensure Data Explorer is using secure encryption",
        "description": "Policy to ensure Data Explorer is using secure encryption"
      },
      {
        "name": "Network",
        "category": "Network Security",
        "displayName": "Ensure Data Explorer is not accessible over the public internet",
        "description": "Policy to ensure Data Explorer is not accessible over the public internet"
      },
      {
        "name": "Identity",
        "category": "Identity Management",
        "displayName": "Ensure usage of centralized identity and auhtorization system for Data Explorer",
        "description": "Policy to ensure Data Explorer is not using local authorization"
      },
      {
        "name": "Logging",
        "category": "Logging and Threat Detection",
        "displayName": "Ensure Data Explorer is logging all events to Log Analytics",
        "description": "Policy to ensure Data Explorer is logging all events to Log Analytics workspace"
      }
    ],
    "parameters": {
      "adeCmk": {
        "type": "string",
        "defaultValue": "Deny"
      },
      "adeEncryption": {
        "type": "string",
        "defaultValue": "Deny"
      },
      "adeDoubleEncryption": {
        "type": "string",
        "defaultValue": "Deny"
      },
      "adeModifyPublicNetworkAccess": {
        "type": "string",
        "defaultValue": "Modify"
      },
      "adePublicNetworkAccess": {
        "type": "string",
        "defaultValue": "Deny"
      },
      "adeSku": {
        "type": "string",
        "defaultValue": "Deny"
      },
      "adeDiagnostics": {
        "type": "string",
        "defaultValue": "DeployIfNotExists"
      },
      "adeLogAnalyticsWorkspaceId": {
        "type": "string",
        "defaultValue": ""
      }
    },
    "policyDefinitions": [
      {
        "policyDefinitionId": "${scope_id_root}/providers/Microsoft.Authorization/policyDefinitions/Dine-Diagnostics-ADE",
        "policyDefinitionReferenceId": "Dine-Diagnostics-ADE",
        "groupNames": [
          "Logging"
        ],
        "parameters": {
          "effect": {
            "value": "[parameters('adeDiagnostics')]"
          },
          "logAnalytics": {
            "value": "[parameters('adeLogAnalyticsWorkspaceId')]"
          }
        }
      },
      {
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/1fec9658-933f-4b3e-bc95-913ed22d012b",
        "policyDefinitionReferenceId": "Deny-ADE-Sku-without-PL-Support",
        "groupNames": [
          "Network"
        ],
        "parameters": {
          "effect": {
            "value": "[parameters('adeSku')]"
          }
        }
      },
      {
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/43bc7be6-5e69-4b0d-a2bb-e815557ca673",
        "policyDefinitionReferenceId": "Deny-ADE-Public-Network-Access",
        "groupNames": [
          "Network"
        ],
        "parameters": {
          "effect": {
            "value": "[parameters('adePublicNetworkAccess')]"
          }
        }
      },
      {
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/7b32f193-cb28-4e15-9a98-b9556db0bafa",
        "policyDefinitionReferenceId": "Modify-ADE-Public-Network-Access",
        "groupNames": [
          "Network"
        ],
        "parameters": {
          "effect": {
            "value": "[parameters('adeModifyPublicNetworkAccess')]"
          }
        }
      },
      {
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/ec068d99-e9c7-401f-8cef-5bdde4e6ccf1",
        "policyDefinitionReferenceId": "Deny-ADE-Double-Encryption",
        "groupNames": [
          "Encryption"
        ],
        "parameters": {
          "effect": {
            "value": "[parameters('adeDoubleEncryption')]"
          }
        }
      },
      {
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/f4b53539-8df9-40e4-86c6-6b607703bd4e",
        "policyDefinitionReferenceId": "Deny-ADE-Encryption",
        "groupNames": [
          "Encryption"
        ],
        "parameters": {
          "effect": {
            "value": "[parameters('adeEncryption')]"
          }
        }
      },
      {
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/81e74cea-30fd-40d5-802f-d72103c2aaaa",
        "policyDefinitionReferenceId": "Deny-ADE-Cmk",
        "groupNames": [
          "Encryption"
        ],
        "parameters": {
          "effect": {
            "value": "[parameters('adeCmk')]"
          }
        }
      }
    ]
  }
}
